!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Socket=e():t.Socket=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>n});const o=function(){function t(){this._map={}}return t.prototype.add=function(t,e){var o=this._map[t];o?o.push(e):this._map[t]=[e]},t.prototype.remove=function(t,e){var o=this._map[t];if(o){var n=o.indexOf(e);if(n>=0)return o.splice(n,1),!0}return!1},t.prototype.trigger=function(t,e){var o=this._map[t];o&&o.forEach((function(t){t(e)}))},t.prototype.clear=function(){this._map={}},t.prototype.count=function(t){var e=this._map[t];return e?e.length:0},t}(),n=function(){function t(t){this._subscribeCount=0,this._queueData=[],this._paramsCache={},this._recognizers=[],this._interceptors={},this._socketListener=new o,this._subscribeListener=new o,this._options=t||{}}return t.prototype.on=function(t,e){this._socketListener.add(t,e)},t.prototype.once=function(t,e){var o=this,n=function(i){e(i),o.off(t,n)};this.on(t,n)},t.prototype.off=function(t,e){this._socketListener.remove(t,e)},t.prototype.subscribe=function(t,e,o){this._subscribeListener.add(t,e),this._updateCount(1),1===this._subscribeListener.count(t)&&this._dispatchAction("subscribe",t,o),o&&this.update(t,o)},t.prototype.subscribeOnce=function(t,e,o){var n=this,i=function(s){e(s),n.unsubscribe(t,i,o)};this.subscribe(t,i,o)},t.prototype.update=function(t,e){this._subscribeListener.count(t)>0&&this._dispatchAction("update",t,e)},t.prototype.unsubscribe=function(t,e,o){this._subscribeListener.remove(t,e)&&(this._updateCount(-1),0===this._subscribeListener.count(t)&&this._dispatchAction("unsubscribe",t,o))},t.prototype.connect=function(t,e){var o=this,n=this._createSocket(t,e);if(n){var i=this._options,s=i.transform,r=i.reconnect,c=i.onWebSocketCreated,u=function(t){o._socketListener.trigger(t.type,t)},a=function(t){u(t),o._sendQueue()},p=function(t){u(t),o._recognize(s?s(t.data):t.data)},h=function(t){u(t)},_=function(t){u(t),1e3!==t.code&&r&&o._reconnect(r),o._destroying&&o._clearReferences(),n.removeEventListener("open",a),n.removeEventListener("message",p),n.removeEventListener("error",h),n.removeEventListener("close",_)};c&&c(n),n.addEventListener("open",a),n.addEventListener("message",p),n.addEventListener("error",h),n.addEventListener("close",_)}},t.prototype.ping=function(t,e){var o,n=this,i=function(){o&&(clearTimeout(o),o=null)},s=function(){i(),o=setTimeout((function(){s(),n.send("function"==typeof e?e():e)}),t)};this.on("open",s),this.on("message",s),this.on("close",i)},t.prototype.interceptor=function(t,e){this._interceptors[t]=e,e.recognizer&&this._recognizers.push({type:t,recognizer:e.recognizer})},t.prototype.send=function(t){"string"!=typeof t&&(t=JSON.stringify(t));var e=this._socket;e&&1===e.readyState?e.send(t):this._queueData.push(t)},t.prototype.close=function(t){this._connecting()&&(t&&(this._socketListener.clear(),this._subscribeListener.clear()),this._socket.close(1e3))},t.prototype.destroy=function(){this._destroying=!0,this.close(!0)},t.prototype._createSocket=function(t,e){if(this._url=t,this._protocols=e,!this._connecting()&&0!==this._subscribeCount){this._cancelReconnect();var o=new WebSocket(t,e);return this._socket=o,o}},t.prototype._reconnect=function(t){var e=this;this._reconnectTimer=setTimeout((function(){e._reconnectTimer=null,e._queueData=Object.values(e._paramsCache),e.connect(e._url,e._protocols)}),"number"==typeof t?t:5e3)},t.prototype._connecting=function(){var t=this._socket;if(t){var e=t.readyState;return 0===e||1===e}return!1},t.prototype._sendQueue=function(){var t=this;this._queueData.length>0&&(this._queueData.forEach((function(e){t._socket.send(e)})),this._queueData=[])},t.prototype._dispatchAction=function(t,e,o){var n=this._paramsCache,i=this._interceptors[e],s=i&&i[t],r=e+".update",c=e+".subscribe";if(s&&(o=s(o,n[r],n[c])),void 0!==o){switch(t){case"subscribe":case"update":n[e+"."+t]=o;break;case"unsubscribe":delete n[c],delete n[r]}this.send(o)}},t.prototype._recognize=function(t){var e=this,o=this._options.recognizer;if(o){var n=o(t);if(!1===n)return;if(n){var i=function(o){e._triggerSubscriber(o,t)};return n instanceof Array?n.forEach(i):i(n)}}var s=this._recognizers;s.length>0&&s.some((function(o){if(o.recognizer(t))return e._triggerSubscriber(o.type,t),!0}))},t.prototype._triggerSubscriber=function(t,e){var o=this._interceptors[t];o&&o.transform&&(e=o.transform(e)),this._subscribeListener.trigger(t,e)},t.prototype._updateCount=function(t){this._subscribeCount+=t,1===t&&this._cancelAutoClose()||(1!==t||1!==this._subscribeCount||!this._url||this._connecting()?-1===t&&0===this._subscribeCount&&this._autoClose():this.connect(this._url,this._protocols))},t.prototype._autoClose=function(){var t=this;this._autoCloseTimer=setTimeout((function(){t._autoCloseTimer=null,t.close()}),5e3)},t.prototype._cancelReconnect=function(){this._reconnectTimer&&(clearTimeout(this._reconnectTimer),this._reconnectTimer=null)},t.prototype._cancelAutoClose=function(){if(this._autoCloseTimer)return clearTimeout(this._autoCloseTimer),this._autoCloseTimer=null,!0},t.prototype._clearReferences=function(){var t=null;this._options=t,this._socket=t,this._url=t,this._protocols=t,this._queueData=t,this._paramsCache=t,this._recognizers=t,this._interceptors=t,this._socketListener=t,this._subscribeListener=t},t}();return e.default})()}));